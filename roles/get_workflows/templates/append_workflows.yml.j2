###############################################################################
# auto-generated by aap-get-content
# total_workflows: {{ workflow_list | length }}
# Ansible Automation Platform: https://{{ aap_hostname }}
# AAP Job ID: {{ tower_job_id }}
# Git User ID: {{ github_user_info.json.login }}
###############################################################################
---
controller_workflows:
{% for template in workflow_list %}
  - name: {{ template.name | to_json(ensure_ascii=False) }} # Name of the workflow job template.
    description: {{ template.description | default('') | to_json(ensure_ascii=False) }} # Description of the template.
    organization: '{{ template.organization }}' # The organization associated with this workflow job template.
{% if template.inventory is defined and template.inventory %}
    inventory: '{{ template.inventory }}'  # Inventory used for this job template (empty for none)
{% endif %}
{% if template.ask_inventory_on_launch is defined %}
    ask_inventory_on_launch: {{ template.ask_inventory_on_launch }} # Asks for inventory on launch (false for not asking).
{% endif %}
{% if template.ask_scm_branch_on_launch is defined %}
    ask_scm_branch_on_launch: {{ template.ask_scm_branch_on_launch }}  # Asks for SCM branch on launch (false for not asking).
{% endif %}
{% if template.ask_limit_on_launch is defined %}
    ask_limit_on_launch: {{ template.ask_limit_on_launch }}  # Asks for limit on launch (false for not asking).
{% endif %}
{% if template.ask_variables_on_launch is defined %}
    ask_variables_on_launch: {{ template.ask_variables_on_launch }}  # Asks for variables on launch (false for not asking).
{% endif %}
{% if template.limit is defined and template.limit %}
    limit: {{ template.limit }} # Limit for the job run (empty for none).
{% endif %}
{% if template.scm_branch is defined and template.scm_branch %}
    scm_branch: {{ template.scm_branch }} # SCM branch (empty for none).
{% endif %}
{% if template.webhook_service is defined and template.webhook_service %}
    webhook_service: {{ template.webhook_service }} # Webhook service (empty for none).
{% endif %}
{% if template.webhook_credential is defined and template.webhook_credential %}
    webhook_credential: {{ template.webhook_credential }} # Webhook credential (empty for none).
{% endif %}
{% if template.extra_vars is defined and template.extra_vars and template.extra_vars != '---' and template.extra_vars != '' and template.extra_vars != '{}' %}
    extra_vars:
{% set parsed_variables = template.extra_vars | from_yaml %}
      {{ parsed_variables | to_nice_yaml | indent(6) -}}
{% endif %}
    state: present	# change state to absent to delete the workflow
{% if template.simplified_workflow_nodes is defined %}
    simplified_workflow_nodes:
{% for node in template.simplified_workflow_nodes %}
{% if node.unified_job_template_type is defined and node.unified_job_template_type == "inventory_update" %}
      - identifier: {{ node.identifier }}
        all_parents_must_converge: {{ node.all_parents_must_converge }}
        unified_job_template: {{ node.unified_job_template }}
        unified_job_template_type: {{ node.unified_job_template_type }}
{% if node.success_nodes is defined and node.success_nodes | length > 0  %}
        success_nodes:
{% for identifier in node.success_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.failure_nodes is defined and node.failure_nodes | length > 0  %}
        failure_nodes:
{% for identifier in node.failure_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.always_nodes is defined and node.always_nodes | length > 0  %}
        always_nodes:
{% for identifier in node.always_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% endif %}
{% if node.unified_job_template_type is defined and node.unified_job_template_type == "job" %}
      - identifier: {{ node.identifier }}
        all_parents_must_converge: {{ node.all_parents_must_converge }}
        unified_job_template: {{ node.unified_job_template }}
        unified_job_template_type: {{ node.unified_job_template_type }}
{% if node.success_nodes is defined and node.success_nodes | length > 0  %}
        success_nodes:
{% for identifier in node.success_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.failure_nodes is defined and node.failure_nodes | length > 0  %}
        failure_nodes:
{% for identifier in node.failure_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.always_nodes is defined and node.always_nodes | length > 0  %}
        always_nodes:
{% for identifier in node.always_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% endif %}
{% if node.unified_job_template_type is defined and node.unified_job_template_type == "workflow_approval" %}
      - identifier: {{ node.identifier }}
        all_parents_must_converge: {{ node.all_parents_must_converge }}
        unified_job_template_type: {{ node.unified_job_template_type }}
        approval_node:
          name: {{ node.approval_node.name }}
          description: {{ node.approval_node.description | default('') | to_json(ensure_ascii=False) }}
          timeout: {{ node.approval_node.timeout }}
{% if node.success_nodes is defined and node.success_nodes | length > 0  %}
        success_nodes:
{% for identifier in node.success_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.failure_nodes is defined and node.failure_nodes | length > 0  %}
        failure_nodes:
{% for identifier in node.failure_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.always_nodes is defined and node.always_nodes | length > 0  %}
        always_nodes:
{% for identifier in node.always_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% endif %}
{% if node.unified_job_template_type is defined and node.unified_job_template_type == "project_update" %}
      - identifier: {{ node.identifier }}
        all_parents_must_converge: {{ node.all_parents_must_converge }}
        unified_job_template: {{ node.unified_job_template }}
        unified_job_template_type: {{ node.unified_job_template_type }}
{% if node.success_nodes is defined and node.success_nodes | length > 0  %}
        success_nodes:
{% for identifier in node.success_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.failure_nodes is defined and node.failure_nodes | length > 0  %}
        failure_nodes:
{% for identifier in node.failure_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.always_nodes is defined and node.always_nodes | length > 0  %}
        always_nodes:
{% for identifier in node.always_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% endif %}
{% if node.unified_job_template_type is defined and node.unified_job_template_type == "workflow_job" %}
      - identifier: {{ node.identifier }}
        all_parents_must_converge: {{ node.all_parents_must_converge }}
        unified_job_template: {{ node.unified_job_template }}
        unified_job_template_type: {{ node.unified_job_template_type }}
{% if node.success_nodes is defined and node.success_nodes | length > 0  %}
        success_nodes:
{% for identifier in node.success_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.failure_nodes is defined and node.failure_nodes | length > 0  %}
        failure_nodes:
{% for identifier in node.failure_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% if node.always_nodes is defined and node.always_nodes | length > 0  %}
        always_nodes:
{% for identifier in node.always_nodes %}
          - {{ identifier }}
{% endfor %}
{% endif %}
{% endif %}
{% endfor %}
{% endif %}
{% if template.notification_templates_success is defined %}
    notification_templates_success:
{% for notification_template in template.notification_templates_success %}
      - {{ notification_template  }}
{% endfor %}
{% endif %}
{% if template.notification_templates_started is defined %}
    notification_templates_started:
{% for notification_template in template.notification_templates_started %}
      - {{ notification_template }}
{% endfor %}
{% endif %}
{% if template.notification_templates_error is defined %}
    notification_templates_error:
{% for notification_template in template.notification_templates_error %}
      - {{ notification_template }}
{% endfor %}
{% endif %}
{% if template.notification_templates_approvals is defined %}
    notification_templates_approvals:
{% for notification_template in template.notification_templates_approvals %}
      - {{ notification_template }}
{% endfor %}
{% endif %}
    survey_enabled: {{ template.survey_enabled }}
{% if template.survey_spec is defined %}
    survey_spec:
      name: {{ template.survey_spec.name | default('') | to_json(ensure_ascii=False) }}
      description: {{ template.survey_spec.description | default('') | to_json(ensure_ascii=False) }}
      spec:
{% for individual_spec in template.survey_spec.spec %}
        - question_name: {{ individual_spec.question_name | default('') | to_json(ensure_ascii=False)  }}
          question_description: {{ individual_spec.question_description | default('') | to_json(ensure_ascii=False) }}
          required: {{ individual_spec.required }}
          type: {{ individual_spec.type }}
          variable: {{ individual_spec.variable }}
          min: {{ individual_spec.min }}
          max: {{ individual_spec.max }}
          default: {{ individual_spec.default | default('') | to_json(ensure_ascii=False) }}
          choices: {{ individual_spec.choices | default('') | to_json(ensure_ascii=False) }}
{% endfor %}
{% endif %}

{% endfor %}